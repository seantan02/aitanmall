$(document).ready(function(){$(document).on("submit","#addAddressForm",function(e){e.preventDefault(),showLoader();var t=$(this),n=t.find("button[name='submit']");if(n.data("requestRunning"))return!1;n.data("requestRunning",!0);var a=t.find("input[name='street']"),s=t.find("input[name='unitNumber']"),r=t.find("input[name='city']"),c=t.find("select[name='state']"),i=t.find("input[name='zip']"),o=t.find("select[name='country']"),u=a.val(),d=s.val(),p=r.val(),f=c.val(),l=i.val(),h=o.val(),g=new FormData;g.append("street",u),g.append("unitNumber",d),g.append("city",p),g.append("state",f),g.append("zip",l),g.append("country",h),$.ajax({contentType:!1,processData:!1,type:"POST",url:"/api/user_add_address",dataType:"json",data:g,success:function(e){var a=e;1==a.passcheck?swal({title:"Success",text:a.msg,icon:"success",buttons:!0}).then(function(){$("#addresses").load(location.href+" #addresses>*",""),n.data("requestRunning",!1),t.modal("hide"),hideLoader()}):2==a.passcheck?swal({title:"Opps",text:a.msg,icon:"error",buttons:!0}).then(function(){n.data("requestRunning",!1),hideLoader()}):3==a.passcheck?swal({title:"Server ERROR",text:a.msg,icon:"error",buttons:!0}).then(function(){window.location.href=""}):4==a.passcheck&&swal({title:"Attention",text:a.msg,icon:"info",buttons:!0}).then(function(){window.location.href=a.redirect})},error:function(){}}).then(function(){n.data("requestRunning",!1),hideLoader()})}),$(document).on("click",".deleteAddressBtn",function(e){e.preventDefault(),showLoader();var t=$(this);if(t.data("requestRunning"))return!1;t.data("requestRunning",!0);var n=t.closest(".address").data("address-id"),a=new FormData;a.append("addressId",n),$.ajax({contentType:!1,processData:!1,type:"POST",url:"/api/user_remove_address",dataType:"json",data:a,success:function(e){var n=e;1==n.passcheck?swal({title:"Success",text:n.msg,icon:"success",buttons:!0}).then(function(){$("#addresses").load(location.href+" #addresses>*",""),t.data("requestRunning",!1),hideLoader()}):2==n.passcheck?swal({title:"Opps",text:n.msg,icon:"error",buttons:!0}).then(function(){t.data("requestRunning",!1),hideLoader()}):3==n.passcheck?swal({title:"Server ERROR",text:n.msg,icon:"error",buttons:!0}).then(function(){window.location.href=""}):4==n.passcheck&&swal({title:"Attention",text:n.msg,icon:"info",buttons:!0}).then(function(){window.location.href=n.redirect})},error:function(){}}).then(function(){t.data("requestRunning",!1),hideLoader()})}),$(document).on("click","#addPaymentMethodBtn",function(e){showLoader();var t=$(this);if(t.data("requestRunning"))return!1;t.data("requestRunning",!0);var n=new FormData;n.append("action","add_payment_method"),$.ajax({contentType:!1,processData:!1,type:"POST",url:"/api/user_add_payment_method",dataType:"json",data:n,success:function(e){var n=e;1==n.passcheck?swal({title:"Success",text:n.msg,icon:"success",buttons:!0}).then(function(){$("#paymentMethods").load(location.href+" #paymentMethods>*",""),t.data("requestRunning",!1),hideLoader()}):2==n.passcheck?swal({title:"Opps",text:n.msg,icon:"error",buttons:!0}).then(function(){t.data("requestRunning",!1),hideLoader()}):3==n.passcheck?swal({title:"Server ERROR",text:n.msg,icon:"error",buttons:!0}).then(function(){window.location.href=""}):4==n.passcheck&&swal({title:"Attention",text:n.msg,icon:"info",buttons:!0}).then(function(){window.location.href=n.redirect})},error:function(){}}).then(function(){t.data("requestRunning",!1),hideLoader()})}),$(document).on("click",".manage-card-btn",function(e){e.preventDefault();var t=$(this);if(t.data("requestRunning"))return!1;t.data("requestRunning",!0),showLoader();var n=new FormData;n.append("action","create_portal_session"),$.ajax({contentType:!1,processData:!1,type:"POST",url:"/api/user_create_stripe_portal_session",dataType:"json",data:n,success:function(e){var t=e;1==t.passcheck?swal({title:"Success",text:t.msg,icon:"success",buttons:!0}):4==t.passcheck&&swal({title:"Attention",text:t.msg,icon:"info",buttons:!0}).then(function(){window.location.href=t.redirect})},error:function(){}}),hideLoader(),t.data("requestRunning",!1)}),$(".toggle").click(function(){var e=$(this).data("target");$(e).slideToggle()}),$(document).on("click",".change-language-btn",function(){var e=$(this).data("language");showLoader();var t=new FormData;t.append("language",e),$.ajax({contentType:!1,processData:!1,type:"POST",url:"/api/user_change_language",dataType:"json",data:t,success:function(e){1==e.passcheck?location.reload():alert("System failed to update your language preference. Please reload webpage.")},error:function(){alert("System failed to update your language preference. Please reload webpage.")}}).then(function(){hideLoader()})})});